# 更新日誌

## [版本 3.0.0] - 2025-08-07

### 新增

- **引入「預烘烤環境」架構**: 建立了一套全新的、基於 `tar.xz` 存檔的工具環境管理系統。
    - 新增 `scripts/bake_tool_envs.py` 腳本，用於在「建置階段」預先為所有工具建立、安裝依賴並打包成獨立的虛擬環境存檔。
    - 烘烤腳本預設使用 `xz` 壓縮以優化儲存空間，並以平行模式執行以縮短建置時間。
- **新增 `research_0808.md` 研究文件**: 這是一份詳盡的架構演進文件，記錄了從早期架構、到 Poetry 方案的失敗嘗試、再到最終「預烘烤」方案的完整決策歷程與數據支撐。

### 變更

- **重大架構重構**: 完全移除了所有工具在「執行時」動態建立虛擬環境和安裝依賴的邏輯。
    - 所有工具 (`data_provider_tool.py` 等) 現在啟動時會檢查並解壓縮對應的預烘烤環境，大幅提升了啟動速度和運行穩定性。
- **棄用 `run.sh`**: 隨著「預烘烤」架構的實施，`run.sh` 中負責動態建立環境和安裝依賴的功能已被 `bake_tool_envs.py` 取代，因此 `run.sh` 已被棄用。
- **文件審計**: 全面審計了 `docs/` 目錄下的所有歷史文件，並為已過時的文件添加了明確的標註，確保文件與當前架構同步。

### 效能

- **啟動速度提升**: 工具的首次啟動時間從數十秒（`pip install`）縮短至約 **1-2 秒**（`tar` 解壓縮）。
- **建置效率**: 烘烤腳本採用平行化執行，將 3 個工具的總建置時間從 10.2 秒優化至 7.5 秒。
- **空間效率**: 採用 `xz` 壓縮，將環境存檔的總體積減少了約 27%。

---

## [版本 2.0.0] - 2025-08-06

### 新增

- 引入 `uv` 作為官方的 Python 環境與依賴管理工具，以取代舊有的、不穩定的啟動腳本。
- 新增 `run.sh` 作為統一的服務啟動與監督腳本，負責建立虛擬環境、安裝依賴，並在背景啟動所有服務。

### 變更

- **重大架構重構**: 移除了原有的、基於 Python 的 `scripts/supervisor.py` 監督者腳本。其功能現在由更穩健、更底層的 `run.sh` 腳本實現。
- `local_run.py` 現在被簡化為一個輕量級的看門狗，其唯一職責是呼叫 `run.sh` 並監控其運行，不再處理任何環境或啟動邏輯。
- **改造 `colab_runner.py`**：將其重構為一個純粹的「引導加載器」，負責從 Git 下載最新程式碼，然後以完全分離的背景模式啟動 `run.sh` 監督者。
- 將 `local_run.py` 的看門狗超時時間調整為 60 秒，以加快測試迭代速度。

### 修復

- **徹底解決了「無聲掛起」問題**：透過用 `run.sh` 中的 shell 背景處理機制取代 `supervisor.py` 中的 `subprocess.Popen` 呼叫，完全規避了在受限沙箱環境中會導致主進程掛起的底層 BUG。
- **解決了 `ModuleNotFoundError: No module named 'pytz'` 問題**：透過 `uv` 和 `run.sh` 確保所有 Python 進程（包括 `heartbeat_worker.py`）都在一個安裝了所有必要依賴的、統一的虛擬環境中執行。
