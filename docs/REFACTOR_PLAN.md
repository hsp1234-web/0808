# 前端重構計畫 (Frontend Refactor Plan)

本文檔記錄了將專案前端從單一 HTML 檔案 (`mp3.html`) 重構為現代化、模組化架構的策略與執行步驟。

## 1. 背景與動機

目前的前端由一個巨大的 `mp3.html` 檔案構成，其中包含了所有的 HTML、CSS 和 JavaScript。這種單體式架構導致了以下問題：

- **高度耦合**：多個非同步功能直接操作 DOM，引發了難以追蹤的渲染錯誤。
- **難以維護**：任何小修改都可能影響到其他不相關的功能。
- **測試困難**：無法對單一功能進行隔離測試，導致測試案例脆弱且不可靠。

為了解決這些根本性問題，並為專案未來的擴展打下良好基礎，我們決定進行一次徹底的前端架構重構。

## 2. 核心目標

- **模組化 (Modularity)**：將功能拆分成獨立、高內聚、低耦合的組件。
- **可測試性 (Testability)**：每個組件都應能夠被獨立測試。
- **清晰邊界 (Clear Boundaries)**：每個組件都有明確的職責和介面。
- **增量遷移 (Incremental Migration)**：以不破壞現有功能的方式，逐步建立新架構並遷移功能。

## 3. 技術選型

為了在不引入重量級框架的前提下達成目標，我們選擇以下技術組合：

- **原生 JavaScript 模組 (ES Modules)**：利用瀏覽器內建的模組系統來組織程式碼。
- **Bun Bundler**：使用 `bun` 的內建建置工具來打包、最佳化我們的程式碼，並處理模組相依性。
- **Playwright**：用於對獨立組件和整合後的前端進行端對端測試。

## 4. 執行策略：兩步走

我們採用「先內後外」、「先穩定，再優化」的策略。

### 第一階段：建立新架構骨架 (目前階段)

此階段的目標是建立一個全新的、模組化的工作流程，並將第一個功能（檔案總管）作為範例遷移進來。

- **步驟 1：建立計畫文件** (已完成)
- **步驟 2：建立前端目錄結構**
  - `src/frontend/`
  - `src/frontend/components/`
  - `src/frontend/assets/`
- **步驟 3：建立前端骨架檔案**
  - `src/frontend/index.html` (新的 HTML 進入點)
  - `src/frontend/main.js` (新的 JS 進入點)
  - `src/frontend/components/FileBrowser.js` (第一個模組化組件)
- **步驟 4：設定建置指令**
  - 在 `package.json` 中新增 `build` 指令。
- **步驟 5：更新 `.gitignore`**
  - 將建置產物目錄 `dist/` 加入忽略清單。
- **步驟 6：執行初次建置並提交**
  - 確保建置流程正常，並儲存進度。

### 第二階段：逐步遷移與功能完善

在骨架建立完成後，我們將按照「小步快走」的原則，逐一將 `mp3.html` 中的功能遷移到新的組件中。

- **遷移任務列表**：將「進行中任務」和「已完成任務」列表重構為獨立組件。
- **遷移 YouTube 功能**：將 YouTube 相關功能拆分為數個協同工作的組件。
- **遷移 WebSocket 邏輯**：建立一個專門的 `ApiService.js` 或 `SocketService.js` 模組來集中管理後端通訊。
- **引入狀態管理**：在必要時，引入一個輕量的全域狀態管理器，以解決跨組件通訊問題。
- **編寫單元/組件測試**：為每個遷移完成的組件編寫獨立的 Playwright 測試。

## 5. 風險管理

- **避免一次性大規模修改**：嚴格遵守「小步快走」原則，每次提交都應只包含一個小的、完整的功能或重構。
- **進度遺失**：在每個小步驟完成後立即提交，以避免因意外（如測試環境崩潰）而遺失工作進度。
