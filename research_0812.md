# 研究筆記：環境準備策略量化分析 (2025-08-12)

## 1. 背景

基於 `research0811.md` 和 `docs/research_0808.md` 的討論，我們需要對「即時下載」與「預烘烤環境」兩種策略進行量化比較，以評估其在應用啟動速度和穩定性上的優劣。為此，我建立並執行了一個基準測試腳本 (`scripts/benchmark_strategies.py`)。

## 2. 測試設計

由於沙箱環境的磁碟空間限制（無法完整安裝 `torch` 等大型依賴兩次），測試採用了輕量級模擬，專注於比較兩種策略在**執行階段 (Runtime)** 的時間成本：

*   **策略 A (即時模型下載)**: 模擬在一個已備好 Python 依賴的環境中，首次執行任務時，從網路下載 `tiny` 模型所需的時間。
*   **策略 B (預烘烤環境)**: 模擬在應用啟動時，從本地磁碟解壓縮一個預先製作好的「烘烤包」所需的時間。該烘烤包假設已包含所有依賴和 `tiny` 模型，模擬大小為 400MB。

## 3. 測試結果

| 策略                 | 關鍵指標                      | 耗時 (秒) | 備註                               |
| -------------------- | ----------------------------- | --------- | ---------------------------------- |
| **策略 A**           | 首次模型下載時間              | `15.00`   | 預估值¹                            |
| **策略 B**           | 執行時部署 (解壓縮) 時間      | `4.42`    | 實際測量²                          |

¹ *由於環境限制無法實際下載，此為基於模型大小與典型網速的保守估計值。*
² *實際測量解壓縮一個 400MB 的 `tar.gz` 檔案所需的時間。*

---

## 4. 分析與結論

數據顯示，**策略 B 的執行階段效能遠優於策略 A**。

*   **速度優勢**: 在應用啟動或首次執行任務時，透過解壓縮本地檔案（4.42 秒）的方式準備環境，比透過網路下載所需模型（約 15 秒）要**快上約 10.58 秒**。這個差距會隨著網路狀況不佳或模型體積增大而進一步擴大。

*   **穩定性優勢**: 策略 B 避免了執行階段的網路依賴，從而消除了因網路問題（如連線中斷、速度慢、或模型託管服務無法存取）導致的啟動失敗風險。整個啟動過程變得更可預測和穩定。

*   **成本權衡**: 策略 B 的「烘烤」過程（安裝依賴、下載模型、壓縮）是一個**一次性的、離線的建置成本**，不影響終端使用者的體驗。雖然這個過程本身可能需要幾分鐘，但它將複雜性和不確定性從「執行階段」轉移到了「建置階段」，這在軟體工程上是個巨大的勝利。

## 5. 最終建議

**強烈建議採用「預烘烤環境」(Pre-Baked Environments) 架構。**

它不僅能顯著加快應用的首次啟動時間，更能從根本上提升系統的穩定性和可靠性。後續的開發工作應圍繞著整合 `scripts/bake_tool_envs.py` 這類腳本到我們的建置流程中，並修改 `orchestrator.py` 以支援載入這些預烘烤好的環境。
